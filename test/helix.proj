<Project DefaultTargets="Test">

  <!-- Version included until we get global.json generation to support this SDK. -->
  <Sdk Name="Microsoft.DotNet.Helix.Sdk" Version="1.0.0-beta.19052.1" />

  <Target Name="Gather" BeforeTargets="Test">
    <ItemGroup>
      <ProjectsToTest Include="$(ProjectsToTest)" />
    </ItemGroup>
    <MSBuild Projects="@(ProjectsToTest)"
              Targets="CreateTestPayload"
              BuildInParallel="true">
      <Output TaskParameter="TargetOutputs" ItemName="TestPayload" />
    </MSBuild>
    <ItemGroup>
      <HelixWorkItem Include="%(TestPayload.TestName)">
        <Command>%(TestPayload.Command)</Command>
        <PayloadDirectory>%(TestPayload.Identity)</PayloadDirectory>
        <Timeout>%(TestPayload.TestTimeout)</Timeout>
      </HelixWorkItem>
    </ItemGroup>
  </Target>

  <PropertyGroup>
    <!-- TODO: Follow up with helix SDK -->
    <SkipInvalidConfigurations>true</SkipInvalidConfigurations>
    <HelixSource>pr/aspnet/extensions</HelixSource>
    <HelixType>ci</HelixType>
    <HelixBuild>private-$(USERNAME)</HelixBuild>
    <HelixBuild Condition=" '$(USERNAME)' == '' ">private-$(USER)</HelixBuild>
    <HelixBuild Condition=" '$(CI)' == 'true' ">$(BUILD_BUILDNUMBER)</HelixBuild>
    <!-- IsExternal is required for .Open helix queues -->
    <IsExternal>true</IsExternal>
    <Creator>aspnet-extensions</Creator>
    <WaitForWorkItemCompletion Condition=" '$(CI)' == 'true' ">true</WaitForWorkItemCompletion>

    <!-- HelixTargetQueues>Windows.10.Amd64.Open;OSX.1012.Amd64.Open;Ubuntu.1604.Amd64.Open</HelixTargetQueues> -->
    <HelixTargetQueues>Windows.10.Amd64.Open;OSX.1012.Amd64.Open;Ubuntu.1604.Amd64.Open;Ubuntu.1810.Amd64.Open;Centos.7.Amd64.Open;Debian.8.Amd64.Open;Debian.9.Amd64.Open;Fedora.27.Amd64.Open;Fedora.28.Amd64.Open;Redhat.7.Amd64.Open;Redhat.6.Amd64.Open;</HelixTargetQueues>
    
    <!--
      xml file found in the work item working directory.
      The following file names are accepted:
        testResults.xml
        test-results.xml
        test_results.xml
    -->
    <EnableXUnitReporter Condition="'$(TargetFrameworkIdentifier)' == '.NETFramework'">true</EnableXUnitReporter>

  </PropertyGroup>
</Project>
